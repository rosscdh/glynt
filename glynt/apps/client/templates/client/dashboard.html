{% extends 'client/base.html' %}
{% load url from future %}
{% load i18n %}

{% block body %}

<!-- <h3>{% trans 'Documents' %}</h3>
<a id="create-document" href="{% url 'document:create' %}" class="btn btn-primary">{% trans 'New Doc' %}</a>
<dl id="available-document-list" class="dl-horizontal">
<dt>{% trans 'Available Documents' %}</dt>
<dd>
    <i>{% blocktrans %}Documents{% endblocktrans %}</i>
    <ul id="public-documents">

    </ul>
</dd> -->


<div class="row">
  <div class="span12">
    <h2>New Document
      <small>Documents available to create</small>
      </h2>
      <br />
      <div class="accordion" id="accordion2">
              <div class="accordion-group">
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
                      New Starter Documents
                    </a>
                  </div>
                  <div id="collapseOne" class="accordion-body collapse in">
                    <div class="accordion-inner">
                      <div class="row contracts">
                <div class="span2">Employment Contract</div>
                <div class="span2">Employment Offer Letter</div>
                <div class="span2">Independent contractor agreement</div>
                <div class="span2">Company handbook</div>
                <div class="span2">Employment Agreement</div>
              </div>
                    </div>
                  </div>
              </div>
              <div class="accordion-group">
                <div class="accordion-heading">
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo">
                    All HR Documents
                  </a>
                </div>
                <div id="collapseTwo" class="accordion-body collapse">
                    <div class="accordion-inner">
                      <div class="row contracts">
                <div class="span2">Employment Contract</div>
                <div class="span2">Employment Offer Letter</div>
                <div class="span2">Independent contractor agreement</div>
                <div class="span2">Company handbook</div>
                <div class="span2">Employment Agreement</div>
              </div>
            </div>
                </div>
              </div>
         <div class="accordion-group">
                  <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseThree">
                      Beta Documents
                    </a>
                  </div>
                  <div id="collapseThree" class="accordion-body collapse">
                      <div class="accordion-inner">
                        {% for d in public_document_list %}
                        <a href="{% url 'document:view' slug=d.slug %}">{{ d.name }}</a>, 
                        {% endfor %}

              </div>
                  </div>
                </div>
            </div>
  </div>
</div>
<hr/>
<div class="row">
        <div class="span12">
                <h2>Your Documents
                        <small>All of your generated documents</small>
                </h2>
                <br />
                <ul class="nav nav-tabs">
                  <li class="active">
                    <a href="#">All Documents</a>
                  </li>
                  <li><a href="#">Index Ventures</a></li>
                  <li><a href="#">Personal</a></li>
                  <li class="pull-right"><a href="#">Add Category</a></li>
                </ul>
                <br />
                <div class="row">
                        <div class="span12">
                            <ul class="thumbnails">
                        {% for d in my_document_list %}
                                <li class="span3">
                                  <div class="thumbnail">
                                    <img src="http://placehold.it/260x40" alt="">
                                    <div class="caption">
                                      <h5><a href="{% url 'document:my_view' slug=d.slug %}">{{ d.name }}</a></h5>
                                      <p>Between x and y.</p>
                                      <p><a href="{% url 'document:my_view' slug=d.slug %}" class="btn btn-info">{% trans 'Edit' %}</a></p>
                                      <p><a href="#clone" data-url="{% url 'document:my_clone' pk=d.pk %}" data-pk="{{ d.pk }}" class="clone-my-document btn btn-inverse">{% trans 'Clone' %}</a></p>
                                      <p><a href="#export" data-url="{% url 'document:export' slug=d.slug %}" data-pk="{{ d.pk }}" class="export-pdf btn btn-info">{% trans 'Download PDF' %}</a></p>
                                      <p><a href="#delete" data-url="{% url 'document:my_delete' pk=d.pk %}" data-pk="{{ d.pk }}" class="delete-my-document btn btn-warning">{% trans 'Delete' %}</a></p>
                                    </div>
                                  </div>
                                </li>
                        {% endfor %}
                            </ul>
                        </div>
                </div>
        </div>
</div>
{% endblock %}


{% block js %}
<script id="document-controls" type="text/javascript">
$(document).ready(function(){

  $('a.export-pdf').live('click', function(event){
    event.preventDefault();
    var data = {
        csrfmiddlewaretoken: '{{ csrf_raw_token }}',
        md: '',
        id: $(this).attr('data-pk')
    };
    console.log($(this).attr('data-url'))
    $.ajax({
      type: 'POST',
      url: $(this).attr('data-url'),
      data: data,
    })
    .success(function(data, textStatus, jqXHR) {
        data = data[0];
        var filename = data.filename;
        window.open(filename, 'pdf');
    })
    .error(function() { 
        console.log('Error in Javascript event')
    })
    .complete(function() {
    });
  });

  deleted_doc = null;

  $('a.delete-my-document').live('click', function(event){
    event.preventDefault();
    var self = $(this);
    var data = {
        csrfmiddlewaretoken: '{{ csrf_raw_token }}'
    };
    $.ajax({
      type: 'POST',
      url: $(this).attr('data-url'),
      data: data,
    })
    .success(function(data, textStatus, jqXHR) {
      data = data[0];
      var li = self.closest('li');
      var div = li.find('div');
      deleted_doc = div;
      div.fadeOut('slow', function(){
        $(this).remove();
        li.html(data.message);
      });

    })
    .error(function(jqXHR, textStatus, errorThrown) { 
      console.log(jqXHR)
      console.log(textStatus)
      console.log(errorThrown)
      console.log('Error in Javascript event')
    })
    .complete(function() {
    });
  });

  $('a.clone-my-document').live('click', function(event){
    event.preventDefault();
    var self = $(this);
    var data = {
        csrfmiddlewaretoken: '{{ csrf_raw_token }}'
    };
    $.ajax({
      type: 'POST',
      url: $(this).attr('data-url'),
      data: data,
    })
    .success(function(data, textStatus, jqXHR) {
      data = data[0];
      window.location = data.url
    })
    .error(function(jqXHR, textStatus, errorThrown) { 
      console.log(jqXHR)
      console.log(textStatus)
      console.log(errorThrown)
      console.log('Error in Javascript event')
    })
    .complete(function() {
    });
  });

  $('a.undelete-my-document').live('click', function(event){
    event.preventDefault();

    var self = $(this);
    var data = {
        csrfmiddlewaretoken: '{{ csrf_raw_token }}'
    };
    $.ajax({
      type: 'POST',
      url: $(this).attr('href'),
      data: data,
    })
    .success(function(data, textStatus, jqXHR) {
      data = data;
      var li = self.closest('li');
      li.html($(deleted_doc).show());
      $(deleted_doc).children().show();
      console.log(deleted_doc)

    })
    .error(function(jqXHR, textStatus, errorThrown) { 
      console.log(jqXHR)
      console.log(textStatus)
      console.log(errorThrown)
      console.log('Error in Javascript event')
    })
    .complete(function() {
    });
  });


});
</script>
{% endblock %}