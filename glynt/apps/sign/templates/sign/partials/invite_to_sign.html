{% load i18n markup templatetag_handlebars %}{% load url from future %}
<div id="signatory-detail">&nbsp;</div>

<script type="text/javascript" id="js-invitee-list">{{ document.invitees_as_json|default:""|safe }}</script>

{% tplhandlebars "hb-signatory-detail" %}
<form id="add-invite" class="form-horizontal" data-validate="parsley">
<div id="modal-signatory-detail" class="modal hide" tabindex="-1" role="dialog">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel">{% trans 'Invitee' %}</h3>
  </div>
  <div class="modal-body">
    {{#with invitee}}
    <input type="hidden" id="id_detail-id" name="detail-id" value="{{id}}"/>
    <div class="control-group">
      <div class="controls"><input class="input-large" type="text" id="id_detail-name" name="detail-name" data-notblank="true" value="{{name}}" placeholder="{% trans 'Name' %}" /></div>
    </div>
    <div class="control-group">
        <div class="controls"><div class="input-prepend"><span class="add-on">@</span><input class="input-large" type="text" id="id_detail-email" name="detail-email" data-required="true" data-type="email" value="{{email}}" placeholder="{% trans 'Email' %}" /></div></div>
    </div>
    {{/with}}
  </div>
  <div class="modal-footer">
    <button id="detail-done" type="button" class="submit btn btn-primary">{% trans 'Done' %}</button>
  </div>
</div>
</form>
{% endtplhandlebars %}

{% tplhandlebars "hb-invite-signatories" %}
<div id="invite-signatories">
  {{#if can_add_invite}}<a id="invitee-add" href="javascript:;" class="btn btn-inverse signatory_add"><i class="icon-user icon-white"></i>{% trans 'Invite' %}</a>{{/if}}
  <span class="message">{{message}}</span>
  <form id="send-invite" class="form-horizontal">
    <input type="hidden" name="csrfmiddlewaretoken" value="{{csrf_token}}" />
    <ul id="invitees">
    {{#each invitees}}
    <li class="{{#unless has_signed}}has_not_signed{{^}}has_signed{{/unless}} {{#unless email}}no_email{{/unless}}">
      <input type="hidden" id="id_list-name" name="name" value="{{name}}" />
      <input type="hidden" id="id_list-email" name="email" value="{{email}}" />
      {{#if profile_picture}}<img class="{{#if has_signed}}has_signed{{/if}}" src="" data-postload_src="{{profile_picture}}" />{{/if}}
      <i class="icon-remove signatory_remove" data-index_lookup="{{id}}"></i>
      <a class="signatory_detail" data-index_lookup="{{id}}" title="{{email}}" href="">{{name}}</a> 
    </li>
    {{/each}}
    </ul>
    {{#if invitees}}
    <button id="submit-invitation" type="submit" class="btn btn-success btn-mini">{% trans 'Send Invites' %}</button>
    {{/if}}
  </form>
</div>
{% endtplhandlebars %}

<script type="text/javascript" src="{{ STATIC_URL }}js/invite-to-sign.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    {% if target_element %}
    // if we have a target_element specified then instantiate the invite widget
    var inviteToSign = new inviteToSignWidget({
        'target_element': $('{{ target_element }}')
        ,'can_add_invite': $('{{ target_element }}').attr('data-can_add_invite')
        ,'urls': {
          'remove_invitee': "{% url 'sign:delete_invite' pk=document.pk invitation_pk=0 %}"
          ,'send_invitations': "{% url 'sign:process_invite' pk=document.pk %}"
        }
    });
    {% endif %}
});
</script>

<style>
form#add-invite {
    color:#333;
}
  .invitee-vehicle {
    margin:5px 0px;
    padding:0px 5px 5px 5px;
  }
  ul#invitees {
    list-style:none;
    margin:10px 0px;
    padding:0px;
  }
  ul#invitees li {
    border:solid #ccc 2px;
  }
  ul#invitees li.no_email {
    border:solid #c00 2px;
  }
  ul#invitees li.has_not_signed {
    background-color:#fca;
  }
  ul#invitees li.has_signed {
    border:solid #0c0 2px;
    background-color:#0c0;
  }
</style>