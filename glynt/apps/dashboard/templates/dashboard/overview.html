{% extends 'base.html' %}{% load url from future %}{% load glynt_helpers crispy_forms_tags project_tags %}

{% block page_title %}Overview &mdash; {% project_name project %}{% endblock %}

{% block header %}
    <!-- Page Header -->
    <div class="page-header">
        <div class="container">
            <!-- Header -->
            <h1>Overview</h1>
        </div>
    </div>
{% endblock %}

{% block body %}
<div class="container dashboard-view">
    {% if user.profile.is_customer %}
        {% if not profile_is_complete %}
            <div class="callout callout-danger empty">
                <div class="empty-message empty-message-exclamation-sign">
                    <h3>We need some more information from you</h3>
                    <p>We can't continue with your transaction until you tell us a bit more about your startup.</p>
                    <a href="{% url 'transact:builder' project_uuid=project.uuid tx_range='INTAKE' step='1' %}" class="btn btn-primary">Click here to complete your profile</a>
                </div>
            </div>
        {% else %}

            {% project_lawyers project 'potential' %}

            <div class="row">
                <div class="col col-lg-6">
                    <div class="widget account-attorney">
                        <h3>Your Attorney</h3>
                        {% project_lawyers project 'assigned' %}
                    </div>
                </div>
                <div class="col col-lg-6">
                    <div class="widget transaction-profile">
                        <h3>Transaction Profile</h3>

                        <div class="callout callout-success empty">
                            <div class="empty-message empty-message-ok">
                                <h3>Your transaction profile is up-to-date.</h3>
                                {% if PROJECT_ENVIRONMENT == 'dev' %}<a href="{% url 'transact:builder' project_uuid=project.uuid tx_range='INTAKE' step='1' %}" class="">update</a>{% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

        </div>
    {% else %}
        <div class="alert">
            The Attorney Transaction dashboard is coming shortly. For now, please review the Checklist.
        </div>
    {% endif %}
</div>
{% endblock %}

{% block js %}
<script>
    $(function () {
        $("[data-toggle='tooltip']").tooltip();
    });

    $(document).on( 'click', '[data-engage]', function (event) {
        event.preventDefault();

        var elem = $(this);
        var pk = elem.data('engage');
        var status = elem.data('status');
        var url = '/api/v1/project_lawyer/{pk}'.assign({'pk': pk});
        elem.fadeOut();

        $.ajax({
            type: 'PATCH',
            url: url,
            data: JSON.stringify({'status': status }),
            dataType: 'application/json',
            contentType: 'application/json',
            beforeSend: function (jqXHR, settings) {
                // Pull the token out of the DOM.
                jqXHR.setRequestHeader('X-CSRFToken', $('input[name=csrfmiddlewaretoken]:first').val());
            },
            complete: function () {
                // reload the page to show updated lawyer info
                document.location.reload();
            }
        });
    });
</script>

{% endblock %}