{% extends 'base.html' %}{% load url from future %}{% load glynt_helpers crispy_forms_tags project_tags jsonify %}

{% block page_title %}Overview{% endblock %}

{% block header %}
    <!-- Page Header -->
    <div class="page-header">
        <div class="container">
            <!-- Header -->
            <h1>Your LawPal Projects</h1>
        </div>
    </div>
{% endblock %}

{% block body %}
<div class="container dashboard-view" ng-controller="projectsOverviewCtrl">
    <div class="row">
        <div class="col-12">
            <div class="col-lg-6" ng-repeat="project in data.projects">
                <div class="widget project clearfix">
                    <span class="text-success pull-right engagement-{[{project.currentUserEngagement|lowercase}]}" ng-bind="project.currentUserEngagement"></span>
                    <a class="btn btn-link pull-right" ng-href="{% url 'dashboard:overview' %}{[{project.uuid}]}/" ng-show="project.currentUserEngagement=='Engaged'">View</a>
                    <h3 ng-bind="project.company.name"></h3>
                    <div class="row">
                        <div class="col-3">
                            <em>Action required</em>
                            <div class="widget-content">
                                <button class="btn btn-danger project-action">
                                    <em>1</em>
                                    <span class="label">Feedback</span>
                                </button>
                            </div>
                        </div>
                        <div class="col-9">
                            <em>Discussion 1/3</em>
                            <p>Discussion here</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <table id="lawyer-projects" class="table table-bordered">
                <thead>
                <tr>
                    <th>Company</th>
                    <th class="" colspan="2">Client Contact</th>
                    <th class="text-center">Status</th>
                    <th>Note</th>
                </tr>
                </thead>
                <tbody>
            {% for p in project_lawyer_joins %}
                {% with p.project as project %}
                <tr class="project-list-item {{ p.display_status|lower }}">
                        {% if PROJECT_LAWYER_STATUS.assigned == p.status %}
                            <td>  
                                <h4>{{ project.company }}</h4>
                            </td>
                            <td> 
                                <div class="profile-card" data-template="small" data-username="{{ project.customer.user.username }}">&nbsp;</div>
                            </td>
                            <td><a href="{{ project.get_absolute_url }}" class="text-success btn btn-success">View Project</a></td>
                            <td class="text-center text-success"> 
                                 <strong>{{ p.display_status }}</strong>
                            </td>
                            <td>
                                <small>You have been assigned to this project.</small>
                            </td>
                        {% elif PROJECT_LAWYER_STATUS.rejected == p.status %}
                            <td class="" colspan="5">
                                <span class="text-muted">{{ project.company }} - {{ p.display_status }} (Client selected another attorney)</span>
                            </td>
                        {% elif PROJECT_LAWYER_STATUS.potential == p.status %}
                            <td>  
                                <h4>{{ project.company }}</h4>
                            </td>
                            <td> 
                                <div class="profile-card" data-template="small" data-username="{{ project.customer.user.username }}">&nbsp;</div>
                            </td>
                            <td class="text-left">
                                <a href="{% url 'project:project_contact' slug=project.uuid lawyer=user.username %}" data-toggle="modal" data-target="#overview-modal" data-is_ajax="true" class="btn btn-primary btn-lg">Discuss&nbsp;<span class="badge">{% discussion_notification_count project_lawyer_join=p %}</span></a>
                            </td>
                            <td class="text-center text-warning"> 
                                 <strong>{{ p.display_status }}</strong>
                            </td>
                            <td>
                                <small>You have been proposed to this client. Awaiting client decision. Press the Discuss link to send a message directly to them.</small>
                            </td>
                        {% endif %}
                </tr>
                {% endwith %}
            {% empty %}
                <tr><td colspan="5" class="text-center"><h3 class="softer"><small><i class="glyphicon glyphicon-time "></i></small> Your introductions and active projects will appear here shortly. </h3></td></tr>
            {% endfor %}
                </tbody>
            </table>
            <br />
            <hr />
            <h4>Have a question? <a href="mailto:xw4ux8lx@incoming.intercom.io" class="intercom">Contact the LawPal Team</a>.</h4> 
        </div>
    </div>
</div>

{% include 'dashboard/modals/overview-modal.html' %}
{% endblock %}

{% block js %}
<script type="text/javascript" src="{{ STATIC_URL }}dashboard/angularjs-projectOverviewCtrl.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}dashboard/angularjs-userDirectives.js"></script>
<script language="javaScript">
    LawPal =  {
        "user": {
            'pk': {{ user.pk|default:'null'|jsonify }},
            'username': '{{ user.username }}',
            'full_name': '{{ user.get_full_name }}',
            'is_authenticated': {{ user.is_authenticated|jsonify }}
        },
        'overview': {{ json|jsonify }}
    }
</script>;
{% endblock %}