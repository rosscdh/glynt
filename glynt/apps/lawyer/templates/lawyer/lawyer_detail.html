{% extends 'base.html' %}{% load account_tags lawyer_profile_tags jsonify thumbnail cache %}

{% block page_title %}{{ object.user.get_full_name|default:object.user.username }}{% endblock %}
{% block bodyclass %}lawyer-welcome{% endblock %}

{% block css %}
<link href="{{ STATIC_URL }}css/theme/lawyer-profile.css" rel="stylesheet" charset="utf-8" />
{% endblock %}
{% block js %}
<script type="text/javascript" src="{{ STATIC_URL }}js/Chart.min.js"></script>
{% endblock %}

{% block prebody %}

<div id="hero">
	<div class="container">
		<!-- starts carousel -->
		<div class="row animated fadeInDown">
			<div class="span12">
				<div class="avatar">
					<img src="{% if object.photo %}{{ MEDIA_URL }}{{ object.photo }}{% else %}{{ default_profile_image }}{% endif %}" alt="{{ object.user.get_full_name|default:object.user.username }}" />
				</div>
				<h1>{{ object.user.get_full_name|default:object.user.username }}</h1>
				<h3>{{ object.summary }} <br /> {{ object.primary_firm }}</h3>
			</div>
		</div>
	</div>
</div>
<div class="container profile">
	<div class="row">
		<div class="span8">	
			<h2>About Me</h2>
			<div>
				<p>{{ object.bio|default:"<div class=\"no-data\">No biography yet</div>"|linebreaksbr }}</p>
			</div>
			<br />
		</div>	
		<div class="span4 pull-right">
			<div class="firm">
				<img src="{{ MEDIA_URL }}{{ firm.photo|default:'firm/blank.gif' }}" alt="{{ firm.name }}" class="firm-logo" />
			</div>
			<div class="map">
				{% if object.data.practice_location_1 and not object.data.practice_location_2 %}
					<img src="http://maps.googleapis.com/maps/api/staticmap?size=300x145&markers=color:blue%7Clabel:S%7C{{ object.data.practice_location_1 }}&sensor=false&maptype=roadmap">
				{% endif %}
				{% if object.data.practice_location_1 and object.data.practice_location_2 %}
					<img src="http://maps.googleapis.com/maps/api/staticmap?size=150x145&markers=color:blue%7Clabel:S%7C{{ object.data.practice_location_1 }}&sensor=false"><img src="http://maps.googleapis.com/maps/api/staticmap?size=149x145&markers=color:blue%7Clabel:S%7C{{ object.data.practice_location_2 }}&sensor=false">
				{% endif %}
				<ul>
					{% for practice_location in object.practice_locations  %}
						<li class="marker">{{ practice_location }}</li>
					{% endfor %}	
					<li class="tick">{{ object.data.years_practiced }} Years Practicing</li>
					<li class="star">No endorsements yet</li>
					<!-- <li class="friends"><img src="/static/img/app/small-avatar.jpg" alt="Avatar" /> Benjamin Ling is a mutual contact</li> -->
				</ul>				
			</div>
			
		</div>	
		<div class="span8">
				<h2>Transaction Snapshot</h2>
				<div class="deal-charts row">
					<div class="span4">
						<h5>Transactions by year</h5>
						<br />
						<canvas id="dealChart0" width="300" height="200"></canvas>
					</div>
					<div class="span4" style="position:relative;">			
						<h5>Transactions by type</h5>
						<br />		
						<canvas id="dealChart1" width="220" height="200"></canvas>
						<div style="position:absolute;top:105px;right:-0px">
							<span class="label label-info" style="background-color:#F38630">Series A</span>
							<br /> 
							<span class="label label-info" style="background-color:#6bdb7e">Seed</span> 
							<br />
							<span class="label label-info" style="background-color:#69D2E7">Incorporation</span> 
							<br />
							<span class="label label-info" style="background-color:#f88172">IP</span>
							<br />
							<span class="label label-info" style="background-color:#6ndn7e">Other</span>
						</div>
					</div>
				</div>
		</div>	
	</div>


	<div class="divide">
	    <div class=" buttons">
			<a href="#comingSoonModal" class="btn btn-large btn-primary" title="Message Leilat" data-toggle="modal">Message Leila</a>
			<a href="#comingSoonModal" class="btn btn-large btn-secondary" title="Endorse Leila" data-toggle="modal">Endorse Leila</a>
			<a href="#comingSoonModal" class="btn btn-large btn-tertiary" title="Engage Leila"  data-toggle="modal">Engage Leila</a>
 
			<!-- Modal -->
			<div id="comingSoonModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			  <div class="modal-header">
			    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
			    <h3 id="myModalLabel">Coming Soon</h3>
			  </div>
			  <div class="modal-body">
			    <p>Whilst profiles are in preview mode, this feature is disabled. We will shortly be enabling this for some users as part of our rollout. Stay tuned!</p>
			  </div>
			  <div class="modal-footer">
			    <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Close</button>
			    <!-- <button class="btn btn-primary">Save changes</button> -->
			  </div>
			</div>
		
		</div>
	</div>

<!-- 	<div class="divide">
		<div class="startups">
			<h2>Startups Advised</h2>
			{{ object.data.startups_advised|jsonify }}
		</div>
	</div>

	<div class="divide">
		<div class="endorsements">
			<h2>Client Endorsements</h2>
			<div class="endorsement">
				<img src="/static/img/app/medium-avatar.png" alt="Avatar (Placeholder)" />
				<p>Awesome to work with, responsive and helpful. Instrumental in getting Airbnb to where it is today</p>
				<p class="source">Alex Halliday</p>
			</div>
		</div>
	</div> -->
</div>
{% endblock %}

{% block body %}

<script>

$(document).ready(function () {
	//Get context with jQuery - using jQuery's .get() method.
	var ctx0 = $("#dealChart0").get(0).getContext("2d");
	var ctx1 = $("#dealChart1").get(0).getContext("2d");

	var chartnumbers =
	{ 
	    "incorp":[{{ object.data.volume_incorp_setup|jsonify }}], 
	    "seed": [{{ object.data.volume_seed_financing|jsonify }}], 
	    "seriesa":[{{ object.data.volume_series_a|jsonify }}], 	
	    "ip": [{{ object.data.volume_ip|jsonify }}],
	    "other":[{{ object.data.volume_other|jsonify }}] 	 	
	}

	getByYear = function() {
		var total = {};
		$.each(chartnumbers, function(i,e){
			$.each(e[0], function(y,v){
				// console.log(v)
				total[y] = (total[y] === undefined)? 0 : total[y] += parseInt(v) ;
			})
		})
		var ret_val = []
		$.each(total, function(year,val){
			ret_val.push(val)
		})
		return ret_val
	}


	getByType = function() {
		var total = {};
		$.each(chartnumbers, function(i,e){
			total[i] = (total[i] === undefined)? 0 : total[i];
			$.each(e[0], function(y,v){
				total[i] += parseInt(v)
			})
		})
		return total
	}

	linedefaults = {
		//Boolean - Whether to show labels on the scale	
		scaleShowLabels : true,
	}

	hasValidData = function(){
			var total = 0;
			$.each(getByYear(), function(i){
				total += parseInt(i)
			})
			return total
		}

	if(hasValidData() > 0) {
		new Chart(ctx0).Line({
			labels : ["2010","2011","2012"],
			datasets : [{
					fillColor : "rgba(151,187,205,0.5)",
					strokeColor : "rgba(151,187,205,1)",
					pointColor : "rgba(151,187,205,1)",
					pointStrokeColor : "#fff",
					data : getByYear(),
				}]
			}
			,linedefaults);

			console.log(getByType().seriesa)
		new Chart(ctx1).Doughnut([
			{
				value: getByType().seriesa,
				color:"#F38630"
			},
			{
				value: getByType().seed,
				color : "#6bdb7e"
			},
			{
				value : getByType().incorp,
				color : "#69D2E7",
			},
			{
				value: getByType().other,
				color : "#6ndn7e"
			},
			{
				value : getByType().ip,
				color : "#f88172"
			}			
		]);
	}
});


</script>
{% endblock %}