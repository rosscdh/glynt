{% extends 'base.html' %}{% load crispy_forms_tags %}

{% block page_title %}Marketplace{% endblock %}
{% block bodyclass %}lawyer-welcome{% endblock %}


{% block prebody %}
<link rel="stylesheet" href="{{ STATIC_URL }}css/theme/lawyer-listing.css" type="text/css">

    
<div id="hero">
	<div class="container">
		<!-- starts carousel -->
		<div class="row animated fadeInDown">
			<div class="span12">
				<h1>Find a lawyer for your startup</h1>
			</div>
		</div>
		<div class="dock">
            <form id="lawyer-list-form" data-validate="parsley" action="{% url 'lawyer:list' %}" method="GET" class="form-inline">{% csrf_token %}
                We need a lawyer in {{ form.location|as_crispy_field }} for {{ form.q|as_crispy_field }}
                <br />
                <br />
                <button class="btn btn-large submit" type="submit" id="lawyer-list-filter">Show Lawyers</button> <a href="#" class="btn btn-large">Send to Results</a> 
            </form>
<!-- 			<ul>
				<li class="dock-packages"><a href="#" title="Packages" class="tip">Packages</a></li>
				<li class="dock-firms"><a href="#" title="Firms">Firms</a></li>
				<li class="dock-lawyers dock-active"><a href="#" title="Lawyers">Lawyers</a></li>
			</ul> -->
		</div>
	</div>
</div>

{% endblock %}

{% block body %}

<!-- <div class="container filter">
        <div class="row">
            <div class="span4"><label>Filter by location</label>{{ form.location|as_crispy_field }}</span></div>
            <div class="span4"><label>Filter by keyword</label>{{ form.q|as_crispy_field }}</span></div>
            <div class="span3"><br /><button id="lawyer-list-filter" type="submit" class="submit btn btn-primary">Search</button></span></div>
        </div>
</div> -->
{% include page_template %}


{% endblock %}

{% block js %}
    {{ block.super }}
    <script id="controls-search">

    $(document).ready(function(){

        $('form#lawyer-list-form input').live('click', function(event){
            $(this).select()
        });
        $('button#lawyer-list-filter').live('click', function(event){
            event.preventDefault();
            var form = $( 'form#lawyer-list-form' );

            if (form.parsley( 'validate' )) {
                params = {}
                // remove items with no value
                $.each({
                    'q': encodeURIComponent($('#id_q').val())
                    ,'location': encodeURIComponent($('#id_location').val())
                }, function(k,val){
                    //if (val != '') {
                        params[k] = val;
                    //}
                });

                document.location = form.attr('action') + '?{params}'.assign({'params': $.param(params) });
            }
        });


    /**
    * Dynamic selector functions based on form api urls
    * @TODO unify this with profile form
    */
    locations_lookup = function(filter, callback) {
        var url = '{{ form.api_urls.locations }}';
        var object_list = []
        url = (filter === undefined)? url: url + '&' + filter;
        $.ajax({
            type: 'GET',
            url: url,
            data: null,
            beforeSend: function(jqXHR, settings) {
                // Pull the token out of the DOM.
                jqXHR.setRequestHeader('X-CSRFToken', $('input[name=csrfmiddlewaretoken]').val());
            },
            success: function(data, textStatus, jqXHR){
                $.each(data.objects, function(i,item){
                    object_list.push(item.name)
                })
                // call the calling callback.. javascript
                callback(object_list);
            },
            error: function(data, textStatus, jqXHR){
                console.log(jqXHR)
                console.log(textStatus)
            }
        });
    }

    /**
    * handle typeahead requests
    */
    $.each($('.typeahead[data-provide="ajax"]'), function(i, element) {
        var e = $(element);

        e.typeahead({
            source: function(query, process_callback) {
                var provide = e.attr('data-provide');
                var lookup_name = e.attr('data-source');
                var filter = e.attr('data-filter');
                filter = (filter === undefined)? filter : filter + '=' + query ;
                var fn = window[lookup_name + '_lookup']
                if(typeof fn === 'function') {
                    fn(filter, process_callback);
                }
            }
            ,limit: 15
        });
    });
    });
    </script>
    <script src="{{ STATIC_URL }}endless_pagination/js/endless-pagination.js"></script>
    <script>
        $.endlessPaginate({
            paginateOnScroll: true
            ,paginateOnScrollMargin: 60
            ,paginateOnScrollChunkSize: 5
        });
    </script>
{% endblock %}